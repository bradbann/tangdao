<script>
// 初始化DataGrid对象
$('#dataGrid').dataGrid({
	searchForm: $("#searchForm"),
	columnModel: [
		<%
		// 是否是第一列
		var firstColumn = true;
		// 获取到唯一ID的url参数字符串
		var idParam = '';
		var idParam2 = '';
		for(pk in table.pkList){
			idParam = idParam + (pkLP.index!=1?'&':'') + pk.javaField + '=\'+row.' + pk.javaField + '+\'';
			idParam2 = pk.javaField;
		}
		// 是否仅查询模板
		var isQueryTpl = table.tplCategory == 'query';
		// 生成树表的节点列
		if(table.isTreeEntity){
			for(c in table.columnList){
				if(c.javaField == table.treeViewNameJavaField){
		%>
		{header:'${c.comments}', name:'${c.javaField}', index:'${c.columnName}', width:250, align:"left", frozen:true, formatter: function(val, obj, row, act){
			return '( '+row.${table.treeViewCodeJavaField}+' ) '+'<a href="\${ctx}/${urlPrefix}/form?${idParam}" class="btnList" data-title="${isQueryTpl?'查看':'编辑'}${functionNameSimple}")}">'+(val||row.id)+'</a>';
		}},
		<%
					firstColumn = false;
					break;
				}
			}
		}
		%>
		<%
		for(c in table.columnList){ 
			if(c.isList == "1"){
				// 如果是树结构的字段，则自动忽略
				if(table.isTreeEntity && @StringUtils.inString(c.columnName, 'parent_code',
					'parent_codes', 'tree_sorts', 'tree_leaf', 'tree_level', 'tree_names')
						&& c.javaField != table.treeViewCodeJavaField
						&& c.javaField != table.treeViewNameJavaField){
				}
				// 如果是首列，则输出带链接的列
				else if(firstColumn){
					firstColumn = false;
		%>
		{header:'${c.comments}', name:'${c.javaField}', index:'${c.columnName}', width:150, align:"left", frozen:true, formatter: function(val, obj, row, act){
			return '<a href="\${ctx}/${urlPrefix}/form?${idParam}" class="btnList" data-title="${isQueryTpl?'查看':'编辑'}${functionNameSimple}">'+(val||row.id)+'</a>';
		}},
				<% }else if(c.showType == 'select' || c.showType == 'select_multiple' || c.showType == 'checkbox' || c.showType == 'radio'){ %>
		{header:'${c.comments}', name:'${c.javaField}', index:'${c.columnName}', width:150, align:"center", formatter: function(val, obj, row, act){
			return js.getDictLabel(\${@DictUtils.getDictListJson('${c.optionMap['dictType']}')}, val, '未知}', true);
		}},
				<% }else if(c.showType == "userselect" || c.showType == "officeselect" || c.showType == "areaselect"){ %>
		{header:'${c.comments}', name:'${c.javaField}', index:'${c.columnName}', width:150, align:"center"},
				<% }else{
						if (@StringUtils.inString(c.javaType, 'javutil.Date', 'Integer', 'Long')){
				%>
		{header:'${c.comments}', name:'${c.javaField}', index:'${c.columnName}', width:150, align:"center"},
				<%
						}else if (@StringUtils.inString(c.javaType, 'Float', 'Double')){
				%>
		{header:'${c.comments}', name:'${c.javaField}', index:'${c.columnName}', width:150, align:"right", formatter: function(val, obj, row, act){
			return js.formatNumber(val, 2, false, ''); // 数值类型格式化 (原始数值, 小数位数, 是否千分位, 默认值，金额情况下设置0.00);
		}},
				<%
						}else {
				%>
		{header:'${c.comments}', name:'${c.javaField}', index:'${c.columnName}', width:150, align:"left"},
				<%
						}
				}
			}
		}
		%>
		{header:'操作', name:'actions', width:120, sortable:false, title:false, formatter: function(val, obj, row, act){
			var actions = [];
			<% if(isQueryTpl){ %>
			actions.push('<a href="\${ctx}/${urlPrefix}/form?${idParam}" class="btnList" title="查看${functionNameSimple}"><i class="la la-file-o"></i></a>&nbsp;');
			<% }else{ %>
			\<% if(expIf("hasAuthority('${permissionPrefix}:edit')"){ %>
				actions.push('<a href="\${ctx}/${urlPrefix}/form?${idParam}" class="btnList" title="编辑${functionNameSimple}"><i class="la la-edit"></i></a>&nbsp;');
				<% if(@ObjectUtils.toBoolean(table.optionMap['isHaveDisableEnable'])){ %>
				if (row.status == Global.STATUS_NORMAL){
					actions.push('<a href="\${ctx}/${urlPrefix}/disable?${idParam}" class="btnList" title="停用${functionNameSimple}" data-confirm="确认要停用该${functionNameSimple}吗？")}"><i class="la la-minus-circle"></i></a>&nbsp;');
				}
				if (row.status == Global.STATUS_DISABLE){
					actions.push('<a href="\${ctx}/${urlPrefix}/enable?${idParam}" class="btnList" title="启用${functionNameSimple}" data-confirm="确认要启用该${functionNameSimple}吗？")}"><i class="la la-check-circle"></i></a>&nbsp;');
				}
				<% } %>
				<% if(@ObjectUtils.toBoolean(table.optionMap['isHaveDelete'])){ %>
				actions.push('<a href="\${ctx}/${urlPrefix}/delete?${idParam}" class="btnList" title="删除${functionNameSimple}" data-confirm="确认要删除该${functionNameSimple}<% if(table.isTreeEntity){ %>及所有子${functionNameSimple}<% } %>吗？")}"<% if(table.isTreeEntity){ %> data-deltreenode="'+row.${idParam2}+'"<% } %>><i class="la la-trash"></i></a>&nbsp;');
				<% } %>
				<% if(table.isTreeEntity){ %>
				actions.push('<a href="\${ctx}/${urlPrefix}/form?parentCode='+row.${idParam2}+'" class="btnList" title="新增下级${functionNameSimple}"><i class="la la-plus-square"></i></a>&nbsp;');
				<% } %>
			\<% } %>
			<% } %>
			return actions.join('');
		}}
	],
	<% if(table.isTreeEntity){ %>
	dataId: '${table.treeViewCodeJavaField}'
	treeGrid: true,			// 启用树结构表格
	defaultExpandLevel: 0,	// 默认展开的层次
	expandNodeClearPostData: '${table.treeViewNameJavaField}', // 展开节点清理请求参数数据（一般设置查询条件的字段属性，否则在查询后，不能展开子节点数据）
	<% } %>
	// 加载成功后执行事件
	ajaxSuccess: function(data){
		
	}
});
</script>